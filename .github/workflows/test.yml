frontend-tests:
  name: Frontend UI Tests
  runs-on: ubuntu-latest

  steps:
    - uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend-hrmSOA/package-lock.json

    - name: Install frontend dependencies
      working-directory: frontend-hrmSOA
      run: npm ci

    - name: Install test dependencies
      working-directory: test-hrmSOA
      run: npm ci

    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable

    âœ… - name: Install matching ChromeDriver
      run: |
        CHROME_VERSION=$(google-chrome --version | awk '{print $3}' | cut -d'.' -f1)
        DRIVER_VERSION=$(curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROME_VERSION}")
        wget -q https://chromedriver.storage.googleapis.com/${DRIVER_VERSION}/chromedriver_linux64.zip
        unzip chromedriver_linux64.zip
        sudo mv chromedriver /usr/local/bin/chromedriver
        sudo chmod +x /usr/local/bin/chromedriver

    - name: Start frontend server
      working-directory: frontend-hrmSOA
      run: |
        npm run build
        npm run preview &
        sleep 5

    - name: Run UI tests
      working-directory: test-hrmSOA
      run: npm run test:frontend
      env:
        TEST_BASE_URL: http://localhost:4173
        HEADLESS: 'true'
        TEST_USER_EMAIL: admin@gmail.com
        TEST_USER_PASSWORD: admin123
